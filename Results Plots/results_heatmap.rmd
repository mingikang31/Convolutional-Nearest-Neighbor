---
title: "results heatmap"
output: html_document
---

```{r}
# Install packages
install.packages("ggplot2")
install.package("pheat0ap")

library(ggplot2)
library(pheatmap)
library(plotly)
```


```{R}
best_models_nLLs = model_results %>%
  group_by(analysis_type, Group, Dimension,Alpha, Model) %>% 
  summarise(sum_NLL = sum(Negative_Log_Likelihood_Optimized)) %>%
  rename(`sum nLL` = "sum_NLL") %>%
  separate(Model, 
           into = c("forage", "foraging_type", "method", "param1", "param2", "param3"), sep = "_")%>%
  separate(Alpha, into = c("alpha", "weight", "structure"), sep = "_")%>%
  mutate(weight = ifelse(is.na(weight), "average", weight))%>%
  mutate(weight = ifelse((!is.na(structure) & structure == "w2v"), 1-as.numeric(weight), weight))%>%
  rename("structural model" = "weight")%>%
  mutate(Dimension = paste0("dim=",Dimension),
         `structural model` = 
           ifelse(`structural model` %in% c("w2v", "s2v", "average"), `structural model`,
                                     paste0(`structural model`, " s2v")))%>%
  mutate(method = ifelse(is.na(method), foraging_type, method))%>%
  mutate(foraging_type = fct_recode(foraging_type, 
                                    `pstatic` = "phonologicalstatic", 
                                    `plocal` = "phonologicaldynamiclocal",
                                    `pglobal` = "phonologicaldynamicglobal",
                                    `pswitch` = "phonologicaldynamicswitch",
                                    `static` = "static", `dynamic` = "dynamic", `random` = "random"),
         method = fct_recode(method, 
                             `none` = "static", `none` = "phonologicalstatic", `none` = "baseline",
              `delta` = "delta", `simdrop` = "simdrop", `multi` = "multimodal", `norms` = "norms"))%>%
  mutate(foraging_type = fct_relevel(foraging_type, "random", "static", "pstatic", 
                                     "dynamic", "plocal", "pglobal", "pswitch"),
         method = fct_relevel(method, "norms", "simdrop", "multi", "delta", "none"))
  
NH = best_models_nLLs %>%
  filter(Group == "normal hearing" & analysis_type == "full") %>%
  filter(method != "none") %>%
  ggplot(aes(x = method, y = foraging_type, fill = `sum nLL`)) +
  geom_tile()+
  facet_grid(Dimension ~ `structural model`)+
  scale_fill_gradient2(midpoint =3450)+
  geom_tile(color = 'black', stat = 'identity', height=1, width=1, size = 1,
              data = . %>% group_by(Group) %>% filter(`sum nLL` == min(`sum nLL`))) +
  labs(x = "", y = "foraging model", title = "normal hearing group")+
  theme_few() +
  theme(aspect.ratio = 1,
        plot.title = element_text(hjust = 0.5, size = rel(1.2)),
        axis.text.x = element_text(angle = 45, hjust = 1))

CI = best_models_nLLs %>%
  filter(Group != "normal hearing" & analysis_type == "full") %>%
  filter(method != "none") %>%
  ggplot(aes(x = method, y = foraging_type, fill = `sum nLL`)) +
  geom_tile()+
  facet_grid(Dimension ~ `structural model`, scales = "free")+
  scale_fill_gradient2(midpoint =2900)+
  geom_tile(color = 'black', stat = 'identity', height=1, width=1, size = 1,
              data = . %>% group_by(Group) %>% filter(`sum nLL` == min(`sum nLL`))) +
  labs(x = "switch method", y = "foraging model", title = "cochlear implant group")+
  theme_few() +
  theme(aspect.ratio = 1,
        plot.title = element_text(hjust = 0.5, size = rel(1.2)),
        axis.text.x = element_text(angle = 45, hjust = 1))

gridExtra::grid.arrange(NH,CI, nrow= 2)

#ggsave(here('plots/overall.pdf'), plot = gridExtra::grid.arrange(NH,CI, nrow= 2), units = 'in', width = 15, height = 10)


```